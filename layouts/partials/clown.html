<button id="font-change-button" class="font-change-button" aria-label="Toggle font style">
  <svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 300 302" width="1em" height="1em">
    <path d="m135 6-13 1C58 14 15 56 6 120c-17 113 48 185 158 177 83-6 128-54 132-137C300 63 243 4 147 5l-13 1zm-31 90c13 6 15 29 4 37s-29 5-34-6c-10-20 9-40 30-31zm112 0c18 7 16 36-3 41-20 5-33-10-28-30 4-11 19-16 31-11zM97 171a108 108 0 0 0 112-4l15 19c1 5-34 19-54 22-29 5-74-5-93-19-2-2 10-22 13-22l7 4z"/>
  </svg>
</button>

<script defer>
// Defer non-critical JavaScript
document.addEventListener('DOMContentLoaded', function() {
  const btn = document.getElementById('font-change-button');
  
  function setFontState(isComicSans) {
    document.body.classList.toggle('comic-sans', isComicSans);
    btn.innerHTML = isComicSans 
      ? 'ðŸ¤¡'
      : '<svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 300 302" width="1em" height="1em"><path d="m135 6-13 1C58 14 15 56 6 120c-17 113 48 185 158 177 83-6 128-54 132-137C300 63 243 4 147 5l-13 1zm-31 90c13 6 15 29 4 37s-29 5-34-6c-10-20 9-40 30-31zm112 0c18 7 16 36-3 41-20 5-33-10-28-30 4-11 19-16 31-11zM97 171a108 108 0 0 0 112-4l15 19c1 5-34 19-54 22-29 5-74-5-93-19-2-2 10-22 13-22l7 4z"/></svg>';
    btn.setAttribute('aria-label', isComicSans ? 'Switch to default font' : 'Switch to Comic Sans');
    localStorage.setItem('useComicSans', isComicSans);
  }

  // Use requestIdleCallback for non-critical initialization
  if (window.requestIdleCallback) {
    requestIdleCallback(function() {
      const savedState = localStorage.getItem('useComicSans') === 'true';
      setFontState(savedState);
    });
  } else {
    // Fallback for browsers that don't support requestIdleCallback
    setTimeout(function() {
      const savedState = localStorage.getItem('useComicSans') === 'true';
      setFontState(savedState);
    }, 200);
  }

  btn.addEventListener('click', function() {
    const newState = !document.body.classList.contains('comic-sans');
    setFontState(newState);
  });
});
</script>
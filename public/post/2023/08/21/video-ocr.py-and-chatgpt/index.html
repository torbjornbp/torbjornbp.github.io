<!doctype html><html lang=en-us><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>video-ocr.py (and chatGPT) | Torbjørn Bakken Pedersen's home page</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><p><strong>Torbjørn Bakken Pedersen's page</strong></p><li><a href=/>Home</a></li><li><a href=/resume/>Resume</a></li><li><a href=/categories/>Categories</a></li><li><a href=/index.xml>RSS</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>video-ocr.py (and chatGPT)</span></h1><h2 class=date>2023-08-21</h2></div><main><p>Over the last year or so, I&rsquo;ve been dabbling with various scripts to manipulate video, metadata etc.
I&rsquo;ve been running a wide range of experiments, amongst others grading film scans using Python and Jupyter notebooks (with massive help from <a href=paulduchesne.github.io>Paul Duchesne</a>) and trying use the <a href=https://github.com/kieranjol/IFIscripts>IFIscripts</a> for digital preservation of the scans of my grandparent&rsquo;s Super8 home movies.
I&rsquo;ve been a light user of FFmpeg for years, but I think finally realised how low the bar for starting to use these tools in more advanced ways actually is.</p><p>One of the applications I was trying to run was the <a href=https://www.researchgate.net/publication/358888176_Deep-doLCE_A_deep_learning_approach_for_the_color_reconstruction_of_digitized_lenticular_film>Deep-doLCE</a> tool.
It&rsquo;s a a tool that can be used to recreate the colours of a <a href=https://filmcolors.org/timeline-entry/1240/>Kodacolor</a> film, which I hope to write more about at some point.
It uses a trained AI model to detect the <em>lenticules</em> on the image frames, before performing its magic.
A breath of fresh air considering all the bogus colourised black and white clips you&rsquo;ll see floating around these days&mldr;</p><hr><p>{: data-content=&ldquo;KODACOLOR FILM PROCESSED BY DEEP-DOLCE&rdquo;}</p><video width=100% autoplay muted loop playsinline>
<source src=kodacolor.webm type=video/webm><source src=kodacolor.mp4 type=video/mp4><p>Your browser does not support the video format/codec.</p></video><hr><h2 id=gpt-and-python>GPT and Python</h2><p>While I&rsquo;ve always liked to think of myself as tech savvy, I&rsquo;ve sadly never learned to code.
Running Python scripts has thus been an interesting learning experience.
Simply getting the code to run and setting up the correct dependencies, has often been difficult in itself.
After some months of trying and failing, all I&rsquo;ve really learned is some basic syntax.
Progress is slow, but at least Python strikes me as surprisingly readable.
I think one of the more interesting aspects of learning code, is that you have to adjust the way you attack problems in order to solve them.
You have to define your problems in a code-solvable manner.</p><p>In this same time period there was suddenly a lot of hype surrounding various AI tools.
Chatbots etc. suddenly became widely available and of course I had to try them out (along with everyone else).
Playing around with the GPT chatbots for example was tremendously fun, but I struggled to find any practical use of them in the day to day.</p><p>Working with these chatbots, the accurate <em>description</em> of a problem can be enough to solve it.
This is in theory though, in practice, the chatbots tend to give you odd, inaccurate or, straight up false, answers to a lot of questions.
The challenge seems to be to make the right <em>queries</em>, that is: to only ask about things included in the models&rsquo; training dataset.
While the training dataset is a problematic black box of unknowns, it appears Python code was included there!</p><p>As a Python novice I ended up feeding code snippets and error messages into these bots (primarily GPT-3.5 and 4).
They seem to grasp Python fairly well, and can point out where errors stem from etc.
I even fed the bots answers and solutions from Stackoverflow, so that the bots could dumb it down for me.</p><p>This works remarkably well, even though you have to be patient and often rephrase the same questions again and again to get somewhere.
It&rsquo;s a great learning tool, after a while I&rsquo;ve started to get a better idea of when the bot feeds me faulty solutions (am I learning Python?).
I&rsquo;m sure my involuntary tech-support friends were glad to be pestered less with Python related questions as well.</p><hr><video width=100% autoplay muted loop playsinline>
<source src=demo.webm type=video/webm><source src=demo.mp4 type=video/mp4><p>Your browser does not support the video format/codec.</p></video><hr><h2 id=ocr-processing-intertitles>OCR processing intertitles</h2><p>This spring I had the chance to put all this to the test.
An inquiry on the AMIA-L mailing list peaked my interest.
I set out to create a small script that would OCR intertitles in silent film and output them in some manner along with timecodes.
A friend of mine helped set up a skeleton of code using openCV and the EAST text detection model to detect whether a video frame contained text.
From here on I started tweaking it by feeding chat-GPT with questions and demands for code change suggestions.</p><p>After a few days of forcing GPT to write code and testing, several variables where added and functionality was expanded out.
In the end the functions like this: it analyses every frame in a specified interval for text elements (every 20th frame for example).
If text is detected in a frame, it performs OCR on the frame in question using the Tesseract OCR engine.
The text is then output with timecodes in both a functional SRT file and a JSON file with additional metadata.
OCR language can be specified, a character blacklist can be configured for improved results and a preview of the video with text detection can be toggled on off.
The code is also commented.</p><p><em>Keep in mind, I am barely able to write any Python code myself!</em></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;filename&#34;</span>: <span style=font-style:italic>&#34;testvideo.mp4&#34;</span>,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;date_processed&#34;</span>: <span style=font-style:italic>&#34;2023-08-22-20-26&#34;</span>,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;ocr_language&#34;</span>: <span style=font-style:italic>&#34;dan&#34;</span>,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;analysis_frame_interval&#34;</span>: 20,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;character_blacklist&#34;</span>: <span style=font-style:italic>&#34;@^\u00a8#$\u00ab|{}_\u0131[]\u00b0&lt;&gt;\u00bb%=+\u00b4`\u00a7*&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;frame_number&#34;</span>: 1320,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;timecode_ms&#34;</span>: 54958.33333333333,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;text_detection_confidence&#34;</span>: 0.9985535667492793,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;ocr_text&#34;</span>: <span style=font-style:italic>&#34;Ved en \u00f8de Indsk\u00e6ring\n\naf Floridakysten. En ny\nDag gryer.\n\n&#34;</span>,
</span></span><span style=display:flex><span>        <span style=font-weight:700>&#34;ocr_confidence&#34;</span>: 93.0909090909091
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>All of this was done by querying GPT over and over.
I fed it all of the code or parts of the code depending on what I wanted to tweak.
Queries such as &ldquo;can this code be simplified?&rdquo;, &ldquo;suggest performance tweaks&rdquo;, &ldquo;give me x alternatives to solving problem y?&rdquo; and &ldquo;are there redundant sections in the code?&rdquo; actually allow you to produce and refine code with very limited knowledge about code.</p><p>GPT <em>will</em> make a ton of errors, it <em>will</em> write redundant code, it <em>will</em> leave unused code snippets in your code, as well as a lot of other odd things, but you can easily fix this by asking a parallel GPT instance to look over it.
Working on the script I managed to implement many different variations of the code, evaluating both different text detection and OCR methods etc.
All of the comments in the code as it stands and most of the readme on github was actually written by GPT as well.</p><p>Looking back at it, I&rsquo;m amazed at what I managed to achieve with my limited experience, regardless of whether the script has a fairly limited scope of use.</p><p>The script can be found here: <a href=https://github.com/torbjornbp/video-ocr2srt>https://github.com/torbjornbp/video-ocr2srt</a></p><hr><p>{: data-content=&ldquo;FUNCTIONAL SRT&rdquo;}</p><p><img src=srtscreenshot.webp alt></p></main><script id=partials/analytics.html data-goatcounter=https://torbjorn888888.goatcounter.com/count async src=//gc.zgo.at/count.js></script><footer><hr>© Torbjørn Bakken Pedersen 2023 &ndash; 2024</footer></body></html>